<svelte:head>
  <title>Game of Life</title>
</svelte:head>

<div class="container">
  <ControlPanel on:next="next()" on:init="init($x, $y)">
    <CA id="1" {type} />
  </ControlPanel>
</div>

<style>
  .container {
    width: 100%;
  }
</style>
<script>
  import CA from './_components/CA.html';
  import ControlPanel from './_components/ControlPanel.html'
  import { GameofLifeDefault as defaults, fieldGen, initializer, randomInitializer, naive } from '../modules'

  export default {
    oncreate() {
      const { algorithm, fieldtype, name, statecolors, stati } = defaults
      this.store.set({
        algorithm,
        fieldtype,
        statecolors,
        stati,
        name,
      })
    },
    computed: {
      type: ({ $algorithm }) => $algorithm && $algorithm.name || ''
    },
    components: {
      CA,
      ControlPanel,
    },
    methods: {
      next() {
        console.log('next')
        const { field, statecolors: { length: states }, fieldtype } = this.store.get()
        this.store.set({
          field: naive(field, states),
        })
      },
      init(x, y) {
        console.log('iniiit')
        const { statecolors: { length: states }, fieldtype } = this.store.get()
        const field = fieldGen(fieldtype)(x, y, states, randomInitializer)
        this.store.set({ field })
      }
    }
  };
</script>
